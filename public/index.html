<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>DramaQu PWA Test</title>
    <meta
      name="theme-color"
      content="#000000"
    />
    <meta
      name="apple-mobile-web-app-capable"
      content="yes"
    />
    <meta
      name="mobile-web-app-capable"
      content="yes"
    />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="apple-mobile-web-app-title"
      content="DramaQu"
    />
    <meta
      name="application-name"
      content="DramaQu"
    />
    <link
      rel="manifest"
      href="/manifest.json"
    />
    <link
      rel="icon"
      href="/icon-192.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="/icon-192.png"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #000;
        color: #fff;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      h1 {
        color: #ff6b6b;
        text-align: center;
      }
      .status {
        background: #333;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }
      .standalone-indicator {
        font-size: 18px;
        font-weight: bold;
        color: #4caf50;
      }
      .browser-indicator {
        font-size: 18px;
        font-weight: bold;
        color: #f44336;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé¨ DramaQu PWA Test</h1>

      <div class="status">
        <h2>üì± PWA Status Check</h2>
        <div id="display-mode"></div>
        <div id="standalone-check"></div>
        <div id="sw-status"></div>
        <div id="install-status"></div>
      </div>

      <div class="status">
        <h2>üîß Debug Info</h2>
        <p>
          <strong>URL:</strong>
          <span id="current-url"></span>
        </p>
        <p>
          <strong>User Agent:</strong>
          <span id="user-agent"></span>
        </p>
        <p>
          <strong>Viewport:</strong>
          <span id="viewport-size"></span>
        </p>
        <p>
          <strong>Protocol:</strong>
          <span id="protocol"></span>
        </p>
        <p>
          <strong>Host:</strong>
          <span id="hostname"></span>
        </p>
        <p>
          <strong>Referrer:</strong>
          <span id="referrer"></span>
        </p>
        <p>
          <strong>Display Mode Media Query:</strong>
          <span id="display-mode-mq"></span>
        </p>
        <p>
          <strong>Navigator Standalone:</strong>
          <span id="nav-standalone"></span>
        </p>
      </div>

      <div class="status">
        <h2>üëÅÔ∏è Visual Check (PALING PENTING)</h2>
        <div style="background: #ff6b35; color: white; padding: 15px; border-radius: 5px; margin: 10px 0">
          <strong>üö® CEK SECARA VISUAL:</strong>
          <br />
          ‚Ä¢ Apakah ada
          <strong>tab bar Chrome</strong>
          di atas?
          <br />
          ‚Ä¢ Apakah ada
          <strong>address bar</strong>
          ?
          <br />
          ‚Ä¢ Apakah ada
          <strong>menu Chrome</strong>
          (‚ãÆ) di kanan atas?
          <br />
          ‚Ä¢ Apakah ada
          <strong>badge Chrome</strong>
          di app icon?
          <br />
          <br />
          <strong>Jika YA untuk salah satu di atas ‚Üí MASIH BROWSER MODE</strong>
          <br />
          <strong>Jika TIDAK untuk semua di atas ‚Üí TRUE STANDALONE PWA ‚úÖ</strong>
        </div>
      </div>

      <div class="status">
        <h2>üß™ Manual Test</h2>
        <p><strong>Test Standalone Mode:</strong></p>
        <button
          onclick="simulateStandalone()"
          style="background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px"
        >
          Simulate Standalone Mode
        </button>
        <button
          onclick="resetDetection()"
          style="background: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px"
        >
          Reset Detection
        </button>
        <br />
        <br />
        <small>
          Atau tambahkan
          <code>?homescreen=true</code>
          di URL untuk test manual
        </small>
      </div>

      <div class="status">
        <h2>üìã Instructions</h2>
        <ol>
          <li>
            <strong>Add to Home Screen</strong>
            dari browser menu
          </li>
          <li><strong>Launch dari home screen icon</strong></li>
          <li><strong>Check if browser UI is hidden</strong></li>
          <li>
            Status should show
            <strong>"STANDALONE MODE: YES"</strong>
          </li>
        </ol>
        <div style="background: #333; padding: 10px; margin-top: 10px; border-radius: 5px">
          <strong>‚ö†Ô∏è Important:</strong>
          <br />
          ‚Ä¢ Jika masih ada
          <strong>badge Chrome</strong>
          dan
          <strong>browser UI</strong>
          , berarti masih dalam browser
          <br />
          ‚Ä¢
          <strong>TRUE STANDALONE</strong>
          = tidak ada tab bar, address bar, menu Chrome
          <br />
          ‚Ä¢ Untuk PWA standalone yang sesungguhnya, perlu
          <strong>HTTPS</strong>
          di production
          <br />
          ‚Ä¢ Test di Chrome/Samsung Internet versi terbaru
          <br />
          ‚Ä¢ Jika masih browser mode, coba uninstall & reinstall PWA
        </div>
      </div>
    </div>

    <script>
      // Check display mode
      function checkDisplayMode() {
        const displayMode = document.getElementById("display-mode")
        const standaloneCheck = document.getElementById("standalone-check")

        // Accurate standalone detection for PWA
        const isStandalone =
          window.matchMedia("(display-mode: standalone)").matches ||
          window.navigator.standalone === true ||
          document.referrer.includes("android-app://") ||
          // Fallback for testing: check if launched from home screen (rough detection)
          window.location.search.includes("homescreen") ||
          window.name.includes("homescreen") ||
          document.referrer === ""

        console.log("Standalone checks:", {
          mediaQuery: window.matchMedia("(display-mode: standalone)").matches,
          navigatorStandalone: window.navigator.standalone,
          referrer: document.referrer,
          urlParam: window.location.search.includes("homescreen"),
          windowName: window.name.includes("homescreen"),
          emptyReferrer: document.referrer === "",
        })

        if (isStandalone) {
          displayMode.innerHTML = '<div class="standalone-indicator">‚úÖ STANDALONE MODE: YES</div>'
          standaloneCheck.innerHTML = '<div class="standalone-indicator">üéâ App is running as standalone PWA!</div>'
        } else {
          displayMode.innerHTML = '<div class="browser-indicator">‚ùå STANDALONE MODE: NO</div>'
          standaloneCheck.innerHTML = '<div class="browser-indicator">üåê App is running in browser mode</div>'
        }
      }

      // Check service worker
      function checkServiceWorker() {
        const swStatus = document.getElementById("sw-status")

        if ("serviceWorker" in navigator) {
          swStatus.innerHTML = '<div class="standalone-indicator">‚úÖ Service Worker: SUPPORTED</div>'

          // Try to register SW
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log("SW registered:", registration.scope)
              swStatus.innerHTML = '<div class="standalone-indicator">‚úÖ Service Worker: REGISTERED</div>'
            })
            .catch((error) => {
              console.log("SW registration failed:", error)
              swStatus.innerHTML = '<div class="browser-indicator">‚ùå Service Worker: REGISTRATION FAILED - ' + error.message + "</div>"
            })
        } else {
          swStatus.innerHTML = '<div class="browser-indicator">‚ùå Service Worker: NOT SUPPORTED BY BROWSER</div>'
        }
      }

      // Check install prompt
      function checkInstallPrompt() {
        const installStatus = document.getElementById("install-status")

        let installable = false

        // Check if app is installable
        window.addEventListener("beforeinstallprompt", (e) => {
          installable = true
          installStatus.innerHTML = '<div class="standalone-indicator">‚úÖ PWA Installable: YES</div>'
          e.preventDefault()
        })

        // Fallback check
        setTimeout(() => {
          if (!installable) {
            if (isStandalone) {
              installStatus.innerHTML = '<div class="standalone-indicator">‚úÖ Already Installed as PWA</div>'
            } else {
              installStatus.innerHTML = '<div class="browser-indicator">‚ùå PWA Installable: NO</div>'
            }
          }
        }, 2000)
      }

      // Debug info
      function showDebugInfo() {
        document.getElementById("current-url").textContent = window.location.href
        document.getElementById("user-agent").textContent = navigator.userAgent
        document.getElementById("viewport-size").textContent = `${window.innerWidth}x${window.innerHeight}`
        document.getElementById("protocol").textContent = window.location.protocol
        document.getElementById("hostname").textContent = window.location.hostname
        document.getElementById("referrer").textContent = document.referrer || "none"
        document.getElementById("display-mode-mq").textContent = window.matchMedia("(display-mode: standalone)").matches
        document.getElementById("nav-standalone").textContent = window.navigator.standalone
      }

      // Register service worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/sw.js")
          .then((registration) => {
            console.log("SW registered:", registration.scope)
          })
          .catch((error) => {
            console.log("SW registration failed:", error)
          })
      }

      // Initialize checks
      window.addEventListener("load", () => {
        checkDisplayMode()
        checkServiceWorker()
        checkInstallPrompt()
        showDebugInfo()
      })

      // Re-check on resize (orientation change)
      window.addEventListener("resize", () => {
        setTimeout(() => {
          checkDisplayMode()
          showDebugInfo()
        }, 100)
      })

      // Manual test functions
      function simulateStandalone() {
        // Simulate standalone mode for testing
        window.name = "homescreen-simulated"
        checkDisplayMode()
        alert("Standalone mode simulated! Check status above.")
      }

      function resetDetection() {
        // Reset detection
        window.name = ""
        checkDisplayMode()
        alert("Detection reset! Check status above.")
      }
    </script>
  </body>
</html>
